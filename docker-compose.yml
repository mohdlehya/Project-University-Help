version: "3.8"

services:
  # سأقوم بإلغاء خدمة mongodb المحلية لكي لا تستهلك موارد جهازك وتستخدم Atlas
  # إذا كنت تريد قاعدة بيانات محلية، أعد قسم mongodb كما كان.

  backend:
    build:
      context: .
      target: backend-production
    container_name: gaza-uni-backend
    restart: unless-stopped
    ports:
      - "5000:5000"
    # التعديل هنا: نطلب من دوكر تحميل ملف .env بالكامل
    env_file:
      - .env
    networks:
      - gaza-uni-network

  frontend:
    build:
      context: .
      target: frontend-production
      args:
        # مهم جداً: Vite يحتاج معرفة رابط الـ API وقت البناء (Build time)
        - VITE_API_URL=http://localhost:5000/api
    container_name: gaza-uni-frontend
    restart: unless-stopped
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - gaza-uni-network

networks:
  gaza-uni-network:
    driver: bridge
# version: '3.8'

# services:
#   mongodb:
#     image: mongo:7.0
#     container_name: gaza-uni-mongodb
#     restart: unless-stopped
#     ports:
#       - "27017:27017"
#     volumes:
#       - mongo_data:/data/db
#     networks:
#       - gaza-uni-network

#   backend:
#     build:
#       context: .
#       target: backend-production
#     container_name: gaza-uni-backend
#     restart: unless-stopped
#     ports:
#       - "5000:5000"
#     environment:
#       - PORT=5000
#       - MONGO_URI=mongodb://mongodb:27017/gaza_uni_portal
#     depends_on:
#       - mongodb
#     healthcheck:
#       test: [ "CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:5000/api/universities" ]
#       interval: 30s
#       timeout: 10s
#       retries: 3
#       start_period: 40s
#     networks:
#       - gaza-uni-network

#   frontend:
#     build:
#       context: .
#       target: frontend-production
#     container_name: gaza-uni-frontend
#     restart: unless-stopped
#     ports:
#       - "80:80"
#     depends_on:
#       - backend
#     networks:
#       - gaza-uni-network

# volumes:
#   mongo_data:

# networks:
#   gaza-uni-network:
#     driver: bridge
